function CreateTable(e){var t=e.results;var n=t.data;table=$("#myTable").DataTable({data:n,order:[2,"asc"],orderClasses:true,lengthChange:true,lengthMenu:[10,25,50,75,100],columns:[{type:"string",data:"artist"},{type:"string",data:"venue"},{type:"date",data:"date"},{type:"num-fmt",data:"price"}],language:{searchPlaceholder:"",sSearch:"",infoEmpty:"Nothing to see...",infoFiltered:"",info:"Showing page _PAGE_ of _PAGES_",infoPostFix:" (_MAX_ total records)",sLengthMenu:"_MENU_"},paging:true,pagingType:"simple",autoWidth:true,scrollCollapse:true,responsive:true,stateSave:false,stateSaveParams:function(e,t){t.search.search=""}});var r=document.getElementById("myTable_filter").firstChild;var i=r.firstChild;i.setAttribute("id","search_table");i.setAttribute("type","text");i.setAttribute("tabindex","0");i.setAttribute("title","Live filter records");i.setAttribute("autofocus","");i.setAttribute("placeholder","Filter shows")}function GoogleMapVenue_click(e){toastr.clear();if(e.search(/Danforth Music/i)>=0){address="The Music Hall"}else{address=e}var t={location:toronto,name:address,radius:1e4};var n=new google.maps.places.PlacesService(map);n.nearbySearch(t,PlacesCallback)}function PlacesCallback(e,t){for(var n=0;n<markers.length;n++){markers[n].setMap(null)}if(t==google.maps.places.PlacesServiceStatus.OK){createMarker(e[0]);if(!$("#map-canvas").visible()){$.smoothScroll("map-canvas")}}else{toastr.warning("<div class='toast-extra'>Click to search it</div>",address+" not found")}}function createMarker(e){var t=e.geometry.location;var n=new google.maps.Marker({map:map,animation:google.maps.Animation.DROP,position:e.geometry.location});map.setZoom(14);map.setCenter(n.getPosition());markers.push(n);google.maps.event.addListener(n,"click",function(){infowindow.setContent("<div class='info-window'>"+"<b>"+e.name+"</b>"+"<br>"+e.vicinity+"</div>");infowindow.open(map,this)});google.maps.event.addListener(map,"resize",function(){window.setTimeout(function(){map.panTo(n.getPosition())},400)})}function VenueSearch(){var e="http://google.ca/search?q=toronto+"+address;window.open(e)}var map;var infowindow;var markers=[];var address;var toronto;var table;$(document).ready(function(){function r(e,t){var n=document.createElement("div");n.style.backgroundColor="#fff";n.style.border="2px solid #fff";n.style.borderRadius="3px";n.style.boxShadow="0 2px 6px rgba(0,0,0,.3)";n.style.cursor="pointer";n.style.marginBottom="25px";n.style.marginLeft="0px";n.style.textAlign="center";n.title="Expand";e.appendChild(n);var r=document.createElement("div");r.style.color="rgb(25,25,25)";r.style.fontFamily="Roboto,Arial,sans-serif";r.style.fontSize="10px";r.style.lineHeight="25px";r.style.paddingLeft="5px";r.style.paddingRight="5px";r.innerHTML="Expand";n.appendChild(r);google.maps.event.addDomListener(n,"click",function(){currentCenter=t.getCenter();if($("#map-canvas").height()==200){$("#map-canvas").animate({height:"300px"},{queue:false,duration:500});window.setTimeout(function(){t.panTo(currentCenter)},500)}else{$("#map-canvas").animate({height:"200px"},{queue:false,duration:500})}})}toastr.options={progressBar:false,closeButton:true,positionClass:"toast-bottom-center",onclick:VenueSearch};toronto=new google.maps.LatLng(43.65,-79.34);var e={center:toronto,zoomControl:true,streetViewControl:true,zoom:11};infowindow=new google.maps.InfoWindow;map=new google.maps.Map(document.getElementById("map-canvas"),e);var t=document.createElement("div");var n=new r(t,map);t.index=1;map.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(t);$(window).resize(function(){google.maps.event.trigger(map,"resize")});$.ajax({url:"./data/kimonoData.min.json",dataType:"json",error:function(e,t){console.log(t)},success:CreateTable,complete:function(e){var t=e.responseJSON.results.site[0].updateDate;var n=e.responseJSON.results.site[0].updateTime;var r=e.responseJSON.results.site[0].source.alt;var i=e.responseJSON.results.site[0].source.href;var s={"%DAY%":t,"%TIME%":n,"%SITE%":r,"%URL%":i};str="<code>Last Updated: %DAY% @ %TIME% by</code><a class='update-link' href='%URL%'> %SITE%</a>";updateString=str.replace(/%\w+%/g,function(e){return s[e]||e});$("#update-header").html(updateString);$("#update-footer").html(updateString)}})});$(function(){$("html").keydown(function(e){if(e.which==37){$("#myTable_previous").click()}else if(e.which==39){$("#myTable_next").click()}else if(e.which==27){$("#search_table").val("")}})})
